wOS.setUI||eval(STOR.read("setui.js"));
E.showMessage=function(p,a){"string"==typeof a&&(a={title:a});a=a||{};g.clear(1);global.WIDGETS&&wOS.drawWidgets();g.reset().setFont("Vector",18).setFontAlign(0,-1);var k=global.WIDGETS?24:0,l=g.getWidth(),h=g.getHeight()-k,b=g.getFontHeight(),d=g.wrapString(a.title,l-2),m=g.wrapString(p||"",l-2);h=k+(h+(d.length-m.length)*b)/2;if(a.img){var n=g.imageMetrics(a.img);g.drawImage(a.img,(l-n.width)/2,h-n.height/2);h+=4+n.height/2}g.drawString(m.join("\n"),l/2,h);a.title&&g.setColor(g.theme.fgH).setBgColor(g.theme.bgH).clearRect(0,
k,l-1,k+4+d.length*b).drawString(d.join("\n"),l/2,k+2);wOS.setLCDPower(1)};
E.showPrompt=function(p,a){a||(a={});a.buttons||(a.buttons={Yes:!0,No:!1});var k=Object.keys(a.buttons),l=[];g.clear(1);global.WIDGETS&&wOS.drawWidgets();if(!p)return wOS.setUI(),Promise.resolve();(function(){g.reset().setFont("Vector",18).setFontAlign(0,-1);var h=global.WIDGETS?24:0,b=g.getWidth(),d=g.getHeight()-h,m=g.getFontHeight(),n=g.wrapString(a.title,b-2),t=g.wrapString(p||"",b-2),c=h+(d+(n.length-t.length)*m)/2-24;a.img&&(d=g.imageMetrics(a.img),g.drawImage(a.img,(b-d.width)/2,c-d.height/
2),c+=4+d.height/2);n&&g.setColor(g.theme.fgH).setBgColor(g.theme.bgH).clearRect(0,h,b-1,h+4+n.length*m).drawString(n.join("\n"),b/2,h+2);g.setColor(g.theme.fg).setBgColor(g.theme.bg).drawString(t.join("\n"),b/2,c);c+=t.length*m+32;var r=0;g.setFontAlign(0,0);k.forEach(function(q){return r+=24+g.stringWidth(q)});r>b&&(g.setFont("6x8"),r=0,k.forEach(function(q){return r+=24+g.stringWidth(q)}));var e=(b-r)/2;k.forEach(function(q,v){var u=g.stringWidth(q);e+=(24+u)/2;var f=6+u/2;l.push({x1:e-f,x2:e+
f,y1:c-24,y2:c+24});f=[e-f,c-16,e+f,c-16,e+f+4,c-12,e+f+4,c+12,e+f,c+16,e-f,c+16,e-f-4,c+12,e-f-4,c-12,e-f,c-16];g.setColor(g.theme.bg2).fillPoly(f).setColor(g.theme.fg2).drawPoly(f).drawString(q,e,c+1);e+=(24+u)/2});wOS.setLCDPower(1)})();return new Promise(function(h){wOS.setUI("touch",function(b){l.forEach(function(d,m){b.x>=d.x1&&b.x<=d.x2&&b.y>=d.y1&&b.y<=d.y2&&(E.showPrompt(),h(a.buttons[k[m]]))})})})};E.showAlert=function(p,a){return E.showPrompt(p,{title:a,buttons:{Ok:1}})};