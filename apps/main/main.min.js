var STOR=require("Storage"),wOSI2C=new I2C;wOSI2C.setup({scl:D14,sda:D15,bitrate:2E5});
global.wOS={ON_TIME:10,BRIGHT:.5,FACEUP:!0,VIBRATE:!0,awake:!0,time_left:10,ticker:void 0,buzz:function(a){wOS.VIBRATE&&(a=a?a:100,50>=a?digitalPulse(D6,!1,a):(D6.reset(),setTimeout(function(){D6.set()},a)))},batV:function(){return 7*analogRead(D30)},isCharging:function(){return!D8.read()},setLCDTimeout:function(a){wOS.ON_TIME=5>a?5:a},brightness:function(a){a=1<a?1:0>a?0:a;0==a||1==a?digitalWrite(D12,a):analogWrite(D12,a,{freq:60})},setLCDBrightness:function(a){wOS.BRIGHT=a;wOS.brightness(a)},init:function(){var a=
STOR.readJSON("settings.json",1)||{ontime:10,bright:.5,timezone:1,faceup:!0,vibrate:!0};wOS.ON_TIME=a.ontime;wOS.time_left=a.ontime;wOS.BRIGHT=a.bright;wOS.FACEUP=a.faceup;wOS.VIBRATE="undefined"!=typeof a.vibrate?a.vibrate:!0;E.setTimeZone(a.timezone)},sleep:function(){wOS.awake=!1;wOS.brightness(0);TC.stop();wOS.emit("lcdPower",!1);g.flip();g.lcd_sleep()},wake:function(){wOS.awake=!0;wOS.time_left=wOS.ON_TIME;TC.start();g.lcd_wake();wOS.emit("lcdPower",!0);wOS.brightness(wOS.BRIGHT);wOS.ticker=
setInterval(wOS.tick,1E3)},setLCDPower:function(a){a?wOS.awake?wOS.time_left=wOS.ON_TIME:wOS.wake():wOS.sleep()},isLCDOn:function(){return wOS.awake},tick:function(){wOS.time_left--;0>=wOS.time_left&&(wOS.ticker&&(wOS.ticker=clearInterval(wOS.ticker)),wOS.emit("sleep",!0),wOS.sleep())}};function watchBat(){setWatch(function(){wOS.awake||wOS.wake();wOS.emit("charging",wOS.isCharging())},D8,{edge:"both",repeat:!0,debounce:500})}wOS.init();eval(STOR.read("lcd.js"));var g=ST7789();
g.theme={fg:65535,bg:0,fg2:2047,bg2:0,fgH:65535,bgH:31,dark:!0};wOS.brightness(wOS.BRIGHT);eval(STOR.read("touch.js"));TC.start();wOS.FACEUP&&STOR.read("accel.js")&&(eval(STOR.read("accel.js")),ACCEL.init(),ACCEL.on("faceup",function(){wOS.awake||wOS.wake()}));wOS.ticker=setInterval(wOS.tick,1E3);wOS.POWER=wOS.isCharging();watchBat();STOR.read("alarm.boot.js")&&eval(STOR.read("alarm.boot.js"));wOS.btnWatches=[setWatch(function(){wOS.awake&&load("clock.app.js")},BTN1,{repeat:1})];
setWatch(function(){wOS.awake?wOS.time_left=wOS.ON_TIME:wOS.wake()},BTN1,{repeat:!0,edge:"falling"});setWatch(function(){wOS.awake?(wOS.time_left=wOS.ON_TIME,wOS.btnWatches||setTimeout(reset,500)):wOS.wake()},BTN2,{repeat:!0,edge:"falling"});global.Bangle=wOS;E.getBattery=function(){var a=wOS.batV();return Math.floor(200*((3.7>a?3.7:a)-3.7))};wOS.showLauncher=function(){load("launch.js")};eval(STOR.read("menu.js"));eval(STOR.read("prompt.js"));